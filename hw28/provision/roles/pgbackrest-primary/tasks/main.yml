---
# tasks file for pg_probackup-11

- name: pgbackrest install
  yum:
    name: 
      - pgbackrest
    state: latest

- name: pgBackRest install
  yum:
    name: 
      - pgbackrest
    state: latest

- name: create backup dir
  file:
    path: /opt/pgbackup
    state: directory
    owner: postgres
    group: postgres
    mode: 0700

- name: Add pg_ident.conf to primary data directory
  template: 
    src: pgbackrest.conf.j2
    dest: /etc/pgbackrest.conf

- name: init repo
  shell: pgbackrest --stanza=primary --log-level-console=info --db-port=5432 stanza-create

- name: check repo
  shell: pgbackrest --stanza=primary --log-level-console=info --db-port=5432 check
  register: check_repo

